{{ header }}
<div id="mv-import-product" class="bg-light">
    <div id="container" class="container">
        <div class="row">{{ profile_column_left }}
            <div id="content" class="col-12 col-md-9 col-lg-9 py-5">
                <div class="mv-dashboard-wrap form-horizontal product-imports" id="form-product-import">
                    <div class="row">
                        <div class="col-sm-12 mv-reviews">
                            <div class="form-signin card px-4 box-shadow">
                                <div class="row justify-content-between">
                                    <div>
                                        <h3 class="f-20 font-weight-bold text-uppercase mt-3"><i
                                                    class="fa fa-upload"></i>
                                            {{ heading_title }}
                                        </h3>
                                    </div>
                                    <div class="my-auto">
                                        <a href="{{ back }}" data-toggle="tooltip" title="{{ button_back }}"
                                           class="btn btn-default"><i class="fa fa-reply"></i></a>
                                    </div>
                                </div>

                                <hr style="margin: 15px -25px">


                                <div class="well xl-100">
                                    <div class="form-group">
                                        <label class="col-sm-12 control-label"><span data-toggle="tooltip"
                                                                                     title="{{ help_file }}">{{ entry_file }}</span></label>
                                        <div class="col-sm-12">
                                            <div class="file-area">
                                                <input type="file" name="find_file" accept=".xls,.xlsx,.csv"
                                                       id="input-file" required="required"/>
                                                <div class="file-dummy">
                                                    <div class="success">{{ entry_great }}</div>
                                                    <div class="warning"><i class="fa fa-times-circle"
                                                                            aria-hidden="true"></i> Invalid
                                                    </div>
                                                    <div class="default">{{ entry_dragfile }}</div>
                                                    <br/>
                                                    <small class="small"></small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group required exp-row">
                                        <label class="col-sm-12 control-label" for="input-language"><span
                                                    data-toggle="tooltip"
                                                    title="{{ help_language }}">{{ entry_language }}</span></label>
                                        <div class="col-sm-12">
                                            <select name="find_language_id" id="input-language"
                                                    class="form-control selectpicker show-tick">
                                                {% for language in languages %}
                                                    <option value="{{ language.language_id }}">{{ language.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group required exp-row">
                                        <label class="col-sm-12 control-label" for="input-store"><span
                                                    data-toggle="tooltip"
                                                    title="{{ help_store }}">{{ entry_store }}</span></label>
                                        <div class="col-sm-12">
                                            <select name="find_store[]" id="input-store"
                                                    class="form-control selectpicker show-tick" multiple>
                                                <option value="0" selected="selected">{{ text_default }}</option>
                                                {% for store in stores %}
                                                    <option value="{{ store.store_id }}">{{ store.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group exp-row">
                                        <label class="col-sm-12 control-label" for="input-existsupdate"><span
                                                    data-toggle="tooltip"
                                                    title="{{ help_existsupdate }}">{{ entry_existsupdate }}</span></label>
                                        <div class="col-sm-12 col-xs-12">
                                            {#<div class="col-sm-12 col-xs-12 switch-buttons">#}
                                            {#<div id="input-existsupdate" class="btns">#}
                                            {#<label class="radio-inline">#}
                                            {#<input type="radio" name="find_existsupdate" value="1" checked="checked" />#}
                                            {#<span class='btn first'>{{ text_yes }}</span>#}
                                            {#</label>#}
                                            {#<label class="radio-inline">#}
                                            {#<input type="radio" name="find_existsupdate" value="0" />#}
                                            {#<span class='btn'>{{ text_no }}</span>#}
                                            {#</label>#}
                                            {#</div>#}
                                            <div id="input-existsupdate" class="btns">
                                                <div class="radio d-inline-block">
                                                    <input id="radio-1" type="radio" name="find_existsupdate" value="1"
                                                           checked="checked"/>
                                                    <label for="radio-1" class="radio-label">{{ text_yes }}</label>
                                                </div>
                                                <div class="radio d-inline-block">
                                                    <input id="radio-2" type="radio" name="find_existsupdate"
                                                           value="0"/>
                                                    <label for="radio-2" class="radio-label">{{ text_no }}</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group last-group exp-row">
                                        <label class="col-sm-12 control-label" for="input-importon"><span
                                                    data-toggle="tooltip"
                                                    title="{{ help_importon }}">{{ entry_importon }}</span></label>
                                        {#<div class="col-sm-12 col-xs-12 switch-buttons">#}
                                        {#<div id="input-importon"  class="btns">#}
                                        {#<label class="radio-inline">#}
                                        {#<input type="radio" name="find_importon" value="product_id" checked="checked" />#}
                                        {#<span class='btn first'>{{ text_product_id }}</span>#}
                                        {#</label>#}
                                        {#<label class="radio-inline">#}
                                        {#<input type="radio" name="find_importon" value="model_number" />#}
                                        {#<span class='btn'>{{ text_model }}</span>#}
                                        {#</label>#}
                                        {#<label class="radio-inline">#}
                                        {#<input type="radio" name="find_importon" value="product_name" />#}
                                        {#<span class='btn'>{{ text_product_name }}</span>#}
                                        {#</label>#}
                                        {#</div>#}
                                        {#</div>#}
                                        <div class="col-sm-12 col-xs-12s">
                                            <div id="input-importon" class="btns">
                                                <div class="radio d-inline-block">
                                                    <input id="radio-3" type="radio" name="find_importon"
                                                           value="product_id" checked="checked"/>
                                                    <label for="radio-3"
                                                           class="radio-label">{{ text_product_id }}</label>
                                                </div>
                                                <div class="radio d-inline-block">
                                                    <input id="radio-4" type="radio" name="find_importon"
                                                           value="model_number"/>
                                                    <label for="radio-4" class="radio-label">{{ text_model }}</label>
                                                </div>
                                                <div class="radio d-inline-block">
                                                    <input id="radio-5" type="radio" name="find_importon"
                                                           value="product_name"/>
                                                    <label for="radio-5"
                                                           class="radio-label">{{ text_product_name }}</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group exp-row">
                                        <label class="col-sm-12 control-label"><span data-toggle="tooltip"
                                                                                     title="{{ help_cell_operation }}">{{ entry_cell_operation }}</span></label>
                                        <div class="col-sm-12">
                                            <div class="well well-sm" style="height: 250px; overflow: auto;">
                                                {% for cell_key, cell_operation in cell_operations %}
                                                    <div class="checkbox">
                                                        <label>
                                                            <h4><input type="checkbox"
                                                                       name="find_cell_operations[{{ cell_key }}]"
                                                                       value="1" checked="checked"/>
                                                                {{ cell_operation }}</h4>
                                                        </label>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            <a onclick="$(this).parent().find(':checkbox').prop('checked', true);"
                                               class="btn btn-success btn-xs">{{ text_all }}</a>
                                            <a onclick="$(this).parent().find(':checkbox').prop('checked', false);"
                                               class="btn btn-success btn-xs">{{ text_unall }}</a>
                                        </div>
                                    </div>
                                    <div class="buttons imports row mb-4">
                                        <div class="col-sm-5">
                                            <button type="button" id="importer-product"
                                                    class="btn btn-success btn-block"><i
                                                        class="fa fa-upload"></i> {{ button_import }}</button>
                                        </div>
                                        <div class="col-sm-5">
                                            <a href="{{ sample_download }}" download
                                               class="btn btn-primary btn-block"><i
                                                        class="fa fa-download"></i> {{ button_download }}</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {{ content_bottom }}</div>
        </div>
        <script type="text/javascript"><!--
            $('#input-file').change(function () {
                var fullPath = document.getElementById('input-file').value;
                if (fullPath) {
                    var startIndex = (fullPath.indexOf('\\') >= 0 ? fullPath.lastIndexOf('\\') : fullPath.lastIndexOf('/'));
                    var filename = fullPath.substring(startIndex);
                    if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
                        filename = filename.substring(1);
                    }
                    $('.file-dummy').removeClass('warning').find('.warning').html('');
                    $('.file-dummy').find('.success').html('{{ entry_great }}');
                    $('.file-dummy .small').html(filename);
                }
            });

            // Importer Product
            $('#importer-product').click(function () {

                $('.file-dummy').removeClass('warning').find('.warning').html('');

                var customarray = $('#form-product-import input[type=\'text\'], #form-product-import input[type=\'file\'], #form-product-import input[type=\'hidden\'], #form-product-import select, #form-product-import input[type=\'checkbox\']:checked, #form-product-import input[type=\'radio\']:checked').serialize();

                var file_data = $("#form-product-import input[type=\'file\']").prop("files")[0];
                var form_data = new FormData();
                form_data.append("find_file", file_data)

                $.ajax({
                    url: 'index.php?route=account/mpmultivendor/import_product/import&' + customarray,
                    dataType: 'json',
                    cache: false,
                    contentType: false,
                    processData: false,
                    type: 'post',
                    data: form_data,
                    beforeSend: function () {
                        $('.alert-danger, .alert-success, .text-danger').remove();
                        $('.text-danger').parent().removeClass('has-error');

                        $('#importer-product').button('loading');
                    },
                    complete: function () {
                        $('#importer-product').button('reset');
                    },
                    success: function (json) {
                        $('.form-group, .col-sm-12').removeClass('has-error');

                        if (json['error']) {
                            if (json['error']['store']) {
                                $('#input-store').after('<div class="text-danger">' + json['error']['store'] + '</div>');
                            }

                            if (json['error']['language']) {
                                $('#input-language').after('<div class="text-danger">' + json['error']['language'] + '</div>');
                            }

                            if (json['error']['importon']) {
                                $('#input-importon').after('<div class="text-danger">' + json['error']['importon'] + '</div>');
                            }

                            if (json['error']['file']) {
                                $('.file-dummy').addClass('warning').find('.warning').html(json['error']['file']);
                            }

                            if (json['error']['warning']) {
                                $('.mv-products').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');

                                $('html, body').animate({scrollTop: 0}, 'slow');
                            }

                            $('.text-danger').parent().parent().addClass('has-error');
                        }

                        if (json['success']) {
                            $('.mv-products').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');

                            $('html, body').animate({scrollTop: 0}, 'slow');

                            $('.file-dummy').find('.success').html('<i class="fa fa-check-circle"></i> ' + json['success']);
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        if (xhr.responseText) {
                            $('.mv-products').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + xhr.responseText + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                        }
                    }
                });
            });
            //--></script>
    </div>
</div>
{{ footer }}